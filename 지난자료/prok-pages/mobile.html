<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ì„ êµì‚¬ ê¸°ë„ì¹´ë“œ - ëª¨ë°”ì¼</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <link rel="stylesheet" href="css/mobile.css?v=1.0.0">
  <style>
    html, body {
      min-width: 0 !important;
      max-width: 100vw !important;
      width: 100vw !important;
      box-sizing: border-box;
    }
    body { 
      background: #f5f6fa; 
      margin: 0; 
      font-family: Pretendard, Inter, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow-x: hidden;
    }
    .swiper, .mobile-titlebar, .missionary-card {
      max-width: 400px;
      min-width: 320px;
      width: 100vw;
      margin: 0 auto;
      box-sizing: border-box;
    }
    .swiper { height: 100vh; }
    .swiper-slide { display: flex; align-items: center; justify-content: center; background: #fff; }
    .missionary-card { background: #fff; border-radius: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.13); padding: 1.5rem 0.8rem 1.2rem 0.8rem; display: flex; flex-direction: column; align-items: center; }
    .missionary-avatar { width: 80px; height: 80px; border-radius: 50%; overflow: hidden; margin-bottom: 0.8rem; box-shadow: 0 2px 8px rgba(0,0,0,0.09); }
    .missionary-avatar img { width: 100%; height: 100%; object-fit: cover; }
    .missionary-name { font-size: 1.1rem; font-weight: 700; margin-bottom: 0.2rem; color: #222; text-align: center; }
    .missionary-location { font-size: 0.9rem; color: #888; margin-bottom: 0.8rem; text-align: center; }
    .missionary-info-row { display: flex; justify-content: space-between; width: 100%; margin: 0.5rem 0 0.8rem 0; font-size: 0.85rem; color: #555; }
    .prayer-btn { background: linear-gradient(145deg, #4caf50, #43a047); border: none; width: 44px; height: 44px; border-radius: 50%; color: white; font-size: 1.5rem; cursor: pointer; display: flex; justify-content: center; align-items: center; margin: 0.8rem 0 0.5rem 0; box-shadow: 0 4px 10px rgba(0,0,0,0.13); transition: box-shadow 0.2s; }
    .prayer-btn:active { box-shadow: 0 2px 6px rgba(76,175,80,0.18); }
    .prayer-section { width: 100%; background: #f7f7fa; border-radius: 12px; padding: 0.8rem; margin-top: 0.8rem; font-size: 0.85rem; color: #333; text-align: left; }
    .close-mobile-swiper { position: absolute; top: 12px; right: 12px; background: rgba(0,0,0,0.08); border: none; border-radius: 50%; width: 28px; height: 28px; font-size: 1.1rem; color: #333; z-index: 10; }
    .swiper-pagination-bullets { bottom: 16px !important; }
    .missionary-card table {
      width: 100%;
      max-width: 100%;
      table-layout: auto;
      word-break: keep-all;
      border-collapse: collapse;
    }
    .missionary-card th, .missionary-card td {
      font-size: 0.95em;
      padding: 0.3em 0.5em;
      text-align: center;
    }
    
    /* ì¤‘ë³´ê¸°ë„ì ìˆ˜ í‘œì‹œ ìŠ¤íƒ€ì¼ */
    .prayer-status-box {
      max-width: 400px;
      min-width: 320px;
      width: 100vw;
      margin: 0 auto 1rem auto;
      box-sizing: border-box;
      padding: 1rem 1rem 0.8rem 1rem;
      border-radius: 16px;
      background: linear-gradient(145deg, #e8f5e8, #d4edda);
      color: #155724;
      font-size: 1.05rem;
      font-weight: 600;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .prayer-status-box .prayer-icon {
      font-size: 1.2rem;
    }
    .prayer-status-box .prayer-count-number {
      font-weight: 700;
      color: #4caf50;
    }
    
    @media (max-width: 400px) {
      .swiper, .mobile-titlebar, .missionary-card, .prayer-status-box {
        max-width: 95vw;
        min-width: 320px;
        width: 95vw;
      }
      .missionary-card { padding: 1.1rem 0.4rem 0.8rem 0.4rem; }
      .missionary-name { font-size: 1rem; }
      .prayer-section { font-size: 0.8rem; }
      .prayer-status-box { 
        font-size: 0.98rem; 
        padding: 0.8rem 0.5rem 0.6rem 0.5rem; 
      }
      .missionary-card th, .missionary-card td {
        font-size: 0.85em;
        padding: 0.2em 0.3em;
      }
    }
    @media (max-width: 350px) {
      .swiper, .mobile-titlebar, .missionary-card, .prayer-status-box {
        max-width: 100vw;
        min-width: 320px;
        width: 100vw;
      }
      .missionary-card { padding: 0.8rem 0.2rem 0.6rem 0.2rem; }
      .missionary-name { font-size: 0.95rem; }
      .prayer-section { font-size: 0.75rem; }
      .prayer-status-box { 
        font-size: 0.92rem; 
        padding: 0.6rem 0.2rem 0.4rem 0.2rem; 
      }
    }
    .status-box, .prayer-info-box {
      max-width: 400px;
      min-width: 320px;
      width: 100vw;
      margin: 0 auto 1rem auto;
      box-sizing: border-box;
      padding: 1rem 1rem 0.8rem 1rem;
      border-radius: 16px;
      background: #e0f7fa;
      color: #222;
      font-size: 1.05rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
    }
    @media (max-width: 400px) {
      .status-box, .prayer-info-box {
        max-width: 95vw;
        min-width: 320px;
        width: 95vw;
        font-size: 0.98rem;
        padding: 0.8rem 0.5rem 0.6rem 0.5rem;
      }
    }
    @media (max-width: 350px) {
      .status-box, .prayer-info-box {
        max-width: 100vw;
        min-width: 320px;
        width: 100vw;
        font-size: 0.92rem;
        padding: 0.6rem 0.2rem 0.4rem 0.2rem;
      }
    }
    .missionary-card, .status-box, .prayer-info-box {
      overflow-x: auto;
    }
    .missionary-card table,
    .status-box table,
    .prayer-info-box table {
      width: 100% !important;
      min-width: 0 !important;
      max-width: 100% !important;
      table-layout: auto !important;
      box-sizing: border-box;
      overflow-x: auto;
      display: block;
    }
    .missionary-card th, .missionary-card td,
    .status-box th, .status-box td,
    .prayer-info-box th, .prayer-info-box td {
      min-width: 0 !important;
      max-width: 100% !important;
      word-break: break-word;
      white-space: normal;
    }
  </style>
</head>
<body>
  <!-- ì¤‘ë³´ê¸°ë„ì ìˆ˜ í‘œì‹œ -->
  <div id="prayer-status" class="prayer-status-box" style="display: none;">
    <span class="prayer-icon">ğŸ™</span>
    <span>í˜„ì¬ <span class="prayer-count-number">0</span>ëª…ì˜ ì¤‘ë³´ê¸°ë„ìê°€ í•¨ê»˜ ê¸°ë„í•˜ê³  ìˆìŠµë‹ˆë‹¤</span>
  </div>
  
  <div id="mobile-missionary-swiper"></div>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
  
  <!-- Firebase ì„¤ì • -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCrJIhyTYQ4bTUW4jarFqluD97xKao2kF0",
      authDomain: "prokworldmap.firebaseapp.com",
      databaseURL: "https://prokworldmap-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "prokworldmap",
      storageBucket: "prokworldmap.appspot.com",
      messagingSenderId: "728381830842",
      appId: "1:728381830842:web:cfcb810657e1608d91f483",
      measurementId: "G-SVTPDV602Y"
    };
    
    // Firebase ì´ˆê¸°í™”
    if (window.firebase && window.firebase.initializeApp) {
      if (!window.firebase.apps.length) {
        window.firebase.initializeApp(firebaseConfig);
        console.log('Firebase ì´ˆê¸°í™” ì™„ë£Œ');
      }
    }
  </script>
  
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script src="js/utils.js?v=1.0.0"></script>
  <script src="js/dataManager.js?v=1.0.1"></script>
  <script src="js/ui/MobileMissionarySwiper.js?v=1.0.1"></script>
  
  <script>
    // ì¤‘ë³´ê¸°ë„ì ìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updatePrayerStatusDisplay(count) {
      console.log('Mobile: updatePrayerStatusDisplay í˜¸ì¶œë¨, count:', count);
      
      const prayerStatusBox = document.getElementById('prayer-status');
      const prayerCountNumber = document.querySelector('.prayer-count-number');
      
      console.log('Mobile: prayerStatusBox:', prayerStatusBox);
      console.log('Mobile: prayerCountNumber:', prayerCountNumber);
      
      if (prayerStatusBox && prayerCountNumber) {
        prayerCountNumber.textContent = count;
        prayerStatusBox.style.display = 'flex';
        
        console.log('Mobile: ì¤‘ë³´ê¸°ë„ì ìˆ˜ ì—…ë°ì´íŠ¸ ì™„ë£Œ:', count);
        
        // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
        prayerStatusBox.style.opacity = '0';
        prayerStatusBox.style.transform = 'translateY(-10px)';
        prayerStatusBox.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
        
        setTimeout(() => {
          prayerStatusBox.style.opacity = '1';
          prayerStatusBox.style.transform = 'translateY(0)';
        }, 100);
      } else {
        console.error('Mobile: ì¤‘ë³´ê¸°ë„ì ìˆ˜ í‘œì‹œ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Mobile: DOM ë¡œë“œ ì™„ë£Œ, DataManager ì´ˆê¸°í™” ì‹œì‘');
      
      // ì¤‘ë³´ê¸°ë„ì ìˆ˜ í‘œì‹œ ì´ˆê¸°í™”
      updatePrayerStatusDisplay(0);
      
      // DataManager ì´ˆê¸°í™” ë° ë°ì´í„° ë¡œë”©
      if (typeof DataManager !== 'undefined') {
        console.log('Mobile: DataManager ë°œê²¬, ë°ì´í„° ë¡œë”© ì‹œì‘');
        
        // DataManagerì˜ onDataReady ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        DataManager.onDataReady(function() {
          console.log('Mobile: DataManager ë°ì´í„° ì¤€ë¹„ ì™„ë£Œ');
          console.log('Mobile: ì„ êµì‚¬ ë°ì´í„° ìˆ˜:', DataManager.state.missionaries.length);
          
          // ì„ êµì‚¬ ë°ì´í„° ì •ë ¬ (ìµœì‹  ì—…ë°ì´íŠ¸ ìˆœ)
          const missionaries = DataManager.state.missionaries.slice().sort((a, b) => {
            const dateA = new Date(a.lastUpdate || 0);
            const dateB = new Date(b.lastUpdate || 0);
            return dateB - dateA;
          });
          
          console.log('Mobile: ì •ë ¬ëœ ì„ êµì‚¬ ìˆ˜:', missionaries.length);
          
          // ëª¨ë°”ì¼ ìŠ¤ì™€ì´í¼ í‘œì‹œ
          if (window.showMobileMissionarySwiper) {
            console.log('Mobile: showMobileMissionarySwiper í•¨ìˆ˜ í˜¸ì¶œ');
            window.showMobileMissionarySwiper(missionaries);
          } else {
            console.error('Mobile: showMobileMissionarySwiper í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          }
        });
        
        // ë°ì´í„° ë¡œë”© ì‹œì‘
        console.log('Mobile: DataManager.fetchData í˜¸ì¶œ');
        DataManager.fetchData(function(error) {
          if (error) {
            console.error('Mobile: ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', error);
            return;
          }
          console.log('Mobile: DataManager.fetchData ì™„ë£Œ');
        });
      } else {
        console.error('Mobile: DataManagerë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }
    });
    
    // DataManagerì˜ ì¤‘ë³´ê¸°ë„ì ìˆ˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ì˜¤ë²„ë¼ì´ë“œ
    if (typeof DataManager !== 'undefined') {
      const originalUpdatePrayerCountDisplay = DataManager.updatePrayerCountDisplay;
      DataManager.updatePrayerCountDisplay = function(count) {
        // ì›ë˜ í•¨ìˆ˜ í˜¸ì¶œ
        if (originalUpdatePrayerCountDisplay) {
          originalUpdatePrayerCountDisplay.call(this, count);
        }
        
        // ëª¨ë°”ì¼ í˜ì´ì§€ì˜ ì¤‘ë³´ê¸°ë„ì ìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
        updatePrayerStatusDisplay(count);
      };
    }
    
    // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì •ë¦¬
    window.addEventListener('beforeunload', function() {
      console.log('Mobile: í˜ì´ì§€ ì–¸ë¡œë“œ, ì •ë¦¬ ì‘ì—… ìˆ˜í–‰');
    });
  </script>
</body>
</html> 